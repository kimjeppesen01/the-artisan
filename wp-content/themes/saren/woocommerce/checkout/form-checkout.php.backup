<?php
/**
 * Checkout Form
 *
 * This template can be overridden by copying it to yourtheme/woocommerce/checkout/form-checkout.php.
 *
 * HOWEVER, on occasion WooCommerce will need to update template files and you
 * (the theme developer) will need to copy the new files to your theme to
 * maintain compatibility. We try to do this as little as possible, but it does
 * happen. When this occurs the version of the template file will be bumped and
 * the readme will list any important changes.
 *
 * @see https://woocommerce.com/document/template-structure/
 * @package WooCommerce\Templates
 * @version 9.4.0
 */

if (!defined('ABSPATH')) {
	exit;
}

global $product;

if (class_exists('Redux')) {

	$option = get_option('pe-redux');
}

do_action('woocommerce_before_checkout_form', $checkout);

// If checkout registration is disabled and not logged in, the user cannot checkout.
if (!$checkout->is_registration_enabled() && $checkout->is_registration_required() && !is_user_logged_in()) {
	echo esc_html__(apply_filters('woocommerce_checkout_must_be_logged_in_message', __('You must be logged in to checkout.', 'woocommerce')));
	return;
}


?>

<!-- <span class="saren--checkut--form--progress">
	<span></span>
</span> -->

<?php

$enable_checkout_login_reminder = get_option('woocommerce_enable_checkout_login_reminder');
if (!is_user_logged_in() && $enable_checkout_login_reminder === 'yes' && !WC()->cart->is_empty()) { ?>
	<div class="pe-section saren--checkout--section saren--checkout--login" data-barba-prevent="all">
		<div class="pe-wrapper saren--checkout--wrapper">
			<div class="pe-col-4 sm-12 order--col"></div>
			<div class="pe-col-8 sm-12 form--col login--form--col">
				<?php
				echo do_shortcode('[saren_login_register]'); ?>

			</div>
		</div>
	</div>
<?php } ?>


<?php if (function_exists('WC') && WC()->checkout && !WC()->cart->is_empty()) { ?>

	<form name="checkout" method="post" class="checkout saren--checkout--form woocommerce-checkout"
		action="<?php echo esc_url(wc_get_checkout_url()); ?>" enctype="multipart/form-data">

		<div class="pe-section saren--checkout--section" data-barba-prevent="all">
			<div class="pe-wrapper saren--checkout--wrapper">

				<div class="pe-col-4 sm-12 order--col order--col--main">
					<?php do_action('woocommerce_checkout_before_order_review_heading'); ?>

					<p id="order_review_heading"><?php esc_html_e('Order Summary', 'woocommerce'); ?></p>

					<?php do_action('woocommerce_checkout_before_order_review'); ?>

					<div id="order_review" class="woocommerce-checkout-review-order">
						<?php do_action('woocommerce_checkout_order_review'); ?>
					</div>

					<?php do_action('woocommerce_checkout_after_order_review'); ?>
				</div>

				<div class="pe-col-8 sm-12 form--col">

					<div class="new-checkout-form">

						<?php if ($checkout->get_checkout_fields()): ?>

							<?php do_action('woocommerce_checkout_before_customer_details'); ?>

							<!-- Contact Information -->
							<div class="checkout-section checkout-contact">
								<h3><?php esc_html_e('Contact Information', 'woocommerce'); ?></h3>
								<div class="checkout-fields">
									<?php woocommerce_form_field('billing_email', ['type' => 'email', 'label' => __('Email', 'woocommerce'), 'required' => true], $checkout->get_value('billing_email')); ?>
									<?php woocommerce_form_field('billing_phone', ['type' => 'tel', 'label' => __('Phone', 'woocommerce'), 'required' => true], $checkout->get_value('billing_phone')); ?>
								</div>
							</div>

							<!-- Billing Address -->
							<div class="checkout-section checkout-billing">
								<h3><?php esc_html_e('Billing Address', 'woocommerce'); ?></h3>
								<div class="checkout-fields">
									<?php do_action('woocommerce_checkout_billing'); ?>
								</div>
							</div>

							<!-- Shipping -->
							<?php if (WC()->cart->needs_shipping() && WC()->cart->show_shipping()): ?>
							<div class="checkout-section checkout-shipping">
								<h3><?php esc_html_e('Shipping', 'woocommerce'); ?></h3>
								
								<p class="ship-to-different-address">
									<label class="woocommerce-form__label woocommerce-form__label-for-checkbox checkbox">
										<input id="ship-to-different-address-checkbox" class="woocommerce-form__input woocommerce-form__input-checkbox input-checkbox" type="checkbox" name="ship_to_different_address" value="1" />
										<span><?php esc_html_e('Ship to a different address?', 'woocommerce'); ?></span>
									</label>
								</p>

								<div class="checkout-fields shipping-address-fields" style="display:none;">
									<?php do_action('woocommerce_checkout_shipping'); ?>
								</div>

								<div class="shipping-methods-section">
									<h4><?php esc_html_e('Shipping Method', 'woocommerce'); ?></h4>
									<div id="checkout-shipping-methods-list">
										<?php if (WC()->cart->needs_shipping() && WC()->cart->show_shipping()): ?>
											<?php do_action('woocommerce_review_order_before_shipping'); ?>
											<?php wc_cart_totals_shipping_html(); ?>
											<?php do_action('woocommerce_review_order_after_shipping'); ?>
										<?php endif; ?>
									</div>
								</div>
							</div>
							<?php endif; ?>

							<!-- Payment -->
							<div class="checkout-section checkout-payment">
								<h3><?php esc_html_e('Payment', 'woocommerce'); ?></h3>
								<div class="checkout-fields">
									<?php woocommerce_checkout_payment(); ?>
								</div>
							</div>

							<?php do_action('woocommerce_checkout_after_customer_details'); ?>

						<?php endif; ?>

					</div>

				</div>

			</div>
		</div>

	</form>

<?php } else { ?>

	<div class="saren--cart--empty">

		<div class="saren--empty--cart--wrap">

			<div class="empty--cart--icon">
				<?php echo do_shortcode(file_get_contents(get_template_directory(). '/assets/img/box_open.svg')) ?>
			</div>

			<div class="empty--cart--text">

				<p><?php echo esc_html__('Looks like you have not added anything to you cart. Go ahead and explore our top products.') ?>
				</p>

			</div>


			<?php if (wc_get_page_id('shop') > 0): ?>
				<p class="return-to-shop">

					<?php

					$href = '';

					if (isset($option['empty_cart_button_url'])) {
						$href = esc_url($option['empty_cart_button_url']);
					} else {

						$href = esc_url(apply_filters('woocommerce_return_to_shop_redirect', wc_get_page_permalink('shop')));
					}

					?>

					<a class="button wc-backward<?php echo esc_attr(wc_wp_theme_get_element_class_name('button') ? ' ' . wc_wp_theme_get_element_class_name('button') : ''); ?>"
						href="<?php echo esc_url($href); ?>">
						<?php
						/**
						 * Filter "Return To Shop" text.
						 *
						 * @since 4.6.0
						 * @param string $default_text Default text.
						 */

						if (isset($option['empty_cart_button_text'])) {

							echo esc_html__($option['empty_cart_button_text']);


						} else {

							echo esc_html__(apply_filters('woocommerce_return_to_shop_text', __('Return to shop', 'woocommerce')));

						}


						?>
					</a>
				</p>
			<?php endif; ?>

		</div>

	</div>

<?php } ?>

<?php do_action('woocommerce_after_checkout_form', $checkout); ?>